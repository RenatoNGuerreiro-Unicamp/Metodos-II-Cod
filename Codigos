# Trabalho Métodos II - Grupo 1

import os
os.environ["OMP_NUM_THREADS"] = '1'

import numpy as np              # cálculo otimizado
import pandas as pd             # dataframes e series
import matplotlib.pyplot as plt # graficos
import seaborn as sns           # for plot styling

# 3f para considerar nas visualizacoes no console ate 3 decimais para os floats
pd.options.display.float_format = '{:.3f}'.format

rais = pd.read_csv('RAIS_VINC_PUB_SUL.txt',          #trocando o nome da variável para rais
                        sep = ';',
                        encoding = "Latin-1",
                        header = 0)

rais.info()                     # o programa carregar as informações da RAIS

rais.shape                      # ver o tamanho da RAIS

# Agora vamos limpar as colunas que queremos para a RAIS

rais = rais[['Motivo Desligamento', 
              'Escolaridade após 2005',
              'Faixa Etária',  
              'Sexo Trabalhador',
              'Raça Cor',
              'Faixa Remun Média (SM)',
              'Faixa Tempo Emprego', # Não vamos analisar, mas vamos utilizar para retirar pessoas que estão no período de experiência (até 3 meses)
              'Tipo Defic']]

rais.info()

# Aqui você pode observar como cada coluna se manifesta com os indivíduos analisados
# É só selecionar o que você quer observar e paertar F9

print(rais['Motivo Desligamento'])
print(rais['Escolaridade após 2005'])
print(rais['Faixa Etária'])
print(rais['Sexo Trabalhador'])
print(rais['Raça Cor'])
print(rais['Faixa Remun Média (SM)'])
print(rais['Faixa Tempo Emprego'])
print(rais['Tipo Defic'])

# Vamos alterar os nomes das variáveis
var_names = ['MotivoDesligamento', 'Escolaridade', 'Idade', 
             'Sexo', 'RaçaCor', 
             'Renda', 'Tempo', 'TipoDeficiencia']
rais.columns = var_names     # Estamos trocando as variáveis da rais

rais.info()

# Aqui estamos passando para category, pois os números da rais fazem inferência a uma categoria e não a um número diretamente
rais.MotivoDesligamento = rais.MotivoDesligamento.astype('category')
rais.Escolaridade = rais.Escolaridade.astype('category')
rais.Idade= rais.Idade.astype('category')
rais.Sexo = rais.Sexo.astype('category')
rais.RaçaCor = rais.RaçaCor.astype('category')
rais.Renda = rais.Renda.astype('category')
rais.Tempo = rais.Tempo.astype('category')
rais.TipoDeficiencia = rais.TipoDeficiencia.astype('category')

# Aqui veremos os dados de cada variável
rais.describe(include = ['category'])

# Agora analisaremos a consistencia dos dados para observar se existe valores fora do layout da rais
rais.MotivoDesligamento.value_counts()   # Só iremos utilizar o 11
rais.Escolaridade.value_counts()         # Está certo
rais.Idade.value_counts()                # Retirar o 99 e o 1 (10 até 14 anos não pode trabalhar)
rais.Sexo.value_counts()                 # Está certo
rais.RaçaCor.value_counts()              # Retirar 99
rais.Renda.value_counts()                # Retirar 99
rais.Tempo.value_counts()                # Retirar 1 e 99
rais.TipoDeficiencia.value_counts()      # Está certo

# Agora iremos realizar a limpeza, retirando os dados mencionados a cima
query_MotivoDesligamento = rais.MotivoDesligamento == 11
rais = rais[query_MotivoDesligamento]

query_Idade = (rais.Idade != 99) & (rais.Idade !=1)
rais = rais[query_Idade]

query_Renda = (rais.Renda != 99)
rais = rais[query_Renda]

query_RaçaCor = rais.RaçaCor != 99
rais = rais[query_RaçaCor]

query_Tempo = (rais.Tempo != 99) & (rais.Tempo !=1)
rais = rais[query_Tempo]

# Exibir informações do DataFrame final para verificação
rais.info()

# Aqui eliminaremos todos os dados ausentes na RAIS, para garatir uma análise sem dados faltantes
rais.isna().sum()
rais.dropna(inplace = True, axis = 0)

#Aqui é para salvarmos em um arquivo de texto a nossa RAIS, contribuindo para observarmos se houve erros na construção
rais.to_csv(r'C:\Users\renat\Desktop\Trabalho Métodos II\RAIS_Limpa_Certa.txt', index=False, sep='\t')

# -----------------------------------------------------------------------------------------------------

# Agora vamos iniciar a construção das tabelas para analisar as variáveis que trouxemos

# -----------------------------------------------------------------------------------------------------

# Vamos realizar uma tabela de frequência dos Desligamentos sem justa causa atrelados as variáveis que trouxemos

# Contagem Escolaridade
rais.Escolaridade.value_counts().sort_index()
descritivas_Escolaridade = rais.groupby(['Escolaridade'], observed = True)
type(descritivas_Escolaridade)
descritivas_Escolaridade  = pd.DataFrame(descritivas_Escolaridade ) # dataframe multi index
descritivas_Escolaridade.to_excel(r'C:\Users\renat\Desktop\Trabalho Métodos II\descritivas_Escolaridade.xlsx',  
                               sheet_name ='Tabela Desligamentos sem Justa Causa relação com Escolaridade',
                               index = True) # para que salve os indexadores de escolaridade/sexo
# Contagem Idade
rais.Idade.value_counts().sort_index()

# Contagem Sexo
rais.Sexo.value_counts().sort_index()

# Contagem RaçaCor
rais.RaçaCor.value_counts().sort_index()

# Contagem Renda
rais.Renda.value_counts().sort_index()

# Contagem TipoDeficiencia
rais.TipoDeficiencia.value_counts().sort_index()

descritivas_Desligamentos = rais.groupby(['escolaridade', 'sexo'], observed = True)['remuneracao'].mean().round(2)

